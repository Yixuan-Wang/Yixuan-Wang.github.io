import{_ as l}from"./TheArticle.c49c5829.js";import{o as p,j as o}from"./app.b3b1e6f8.js";const i="Tymnastics (1): \u6807\u7B7E\u8054\u5408\u52A8\u6001\u6D3E\u53D1",y="2022-11-14T00:00:00.000Z",m="comp",g=["pl","typescript"],F=["type"],A={setup(t,{expose:a}){const s={title:"Tymnastics (1): \u6807\u7B7E\u8054\u5408\u52A8\u6001\u6D3E\u53D1",date:"2022-11-14T00:00:00.000Z",category:"comp",tags:["pl","typescript"],keywords:["type"]};return a({frontmatter:s}),(e,c)=>{const n=l;return p(),o(n,{frontmatter:s,inner:`<div><p>\u5728 TypeScript \u7684\u6807\u7B7E\u8054\u5408\uFF08Tagged Union\uFF09\u4E0A\u7C7B\u578B\u5B89\u5168\u5730\u52A8\u6001\u6D3E\u53D1\u3002</p>
<!-- more -->
<h2 id="\u4EC0\u4E48\u662F-tymnastics" tabindex="-1">\u4EC0\u4E48\u662F Tymnastics</h2>
<p>Tymnastics \u5373\u4E3A <strong>Ty</strong>peScript <strong>M</strong>agics &amp; <strong>Nast</strong>y Tac<strong>tics</strong>\u{1F60F}.</p>
<h2 id="tldr" tabindex="-1">TL;DR</h2>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #7F848E; font-style: italic">/* \u6807\u7B7E\u8054\u5408\u7C7B\u578B */</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">valueA</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;B&quot;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">valueB</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">number</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* \u5B9E\u73B0\u7684\u58F0\u660E */</span></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt; {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">variant</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* \u5206\u91CF\u6807\u7B7E */</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Discriminant</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #98C379">&quot;kind&quot;</span><span style="color: #ABB2BF">];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* \u6D3E\u53D1 */</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Dispatch</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">_</span><span style="color: #ABB2BF">: { [</span><span style="color: #E5C07B">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Discriminant</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;]: </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; }) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span></span>
<span class="line"><span style="color: #ABB2BF">) </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75; font-style: italic">_</span><span style="color: #ABB2BF">: infer </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* \u5B9E\u73B0 + \u6D3E\u53D1 */</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">implA</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">variant</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">variant</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">valueA</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">dispatch</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Dispatch</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">A</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">implA</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">B</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">variant</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">\`</span><span style="color: #C678DD">\${</span><span style="color: #E5C07B">variant</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">valueB</span><span style="color: #C678DD">}</span><span style="color: #98C379">\`</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* \u52A8\u6001\u6D3E\u53D1 */</span></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">dynamic_dispatch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">union</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dispatch</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">union</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/* DEMO */</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">valueA</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;42&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;B&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">valueB</span><span style="color: #ABB2BF">: </span><span style="color: #D19A66">42</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">strings</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">].</span><span style="color: #61AFEF">map</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">union</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">dynamic_dispatch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">union</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">union</span><span style="color: #ABB2BF">));</span></span>
<span class="line"></span></code></pre>
<h2 id="\u6807\u7B7E\u8054\u5408\u548C\u52A8\u6001\u6D3E\u53D1" tabindex="-1">\u6807\u7B7E\u8054\u5408\u548C\u52A8\u6001\u6D3E\u53D1</h2>
<p>\u5728 Rust \u4E2D\uFF0C\u6709\u4E00\u4E2A <a href="https://docs.rs/enum_dispatch/latest/enum_dispatch/" target="_blank" rel="noopener"><code>enum_dispatch</code></a> crate\uFF0C\u5728\u53C2\u4E0E\u6D3E\u53D1\u7684\u7C7B\u578B\u53EF\u679A\u4E3E\u7684\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u901A\u8FC7\u8FC7\u7A0B\u5B8F\u4E3A\u679A\u4E3E\uFF08<code>enum</code>\uFF09\u81EA\u52A8\u5B9E\u73B0\u8981\u6D3E\u53D1\u7684\u7279\u5F81\uFF08<code>trait</code>)\uFF0C\u800C\u4E0D\u9700\u8981\u7528\u5230\u865A\u8868 <code>dyn</code>\uFF0C\u53EF\u4EE5\u52A0\u901F\u52A8\u6001\u6D3E\u53D1\u5E76\u51CF\u5C11 boilerplate \u5DE5\u4F5C\uFF0C\u540C\u65F6\u8FD8\u4FDD\u8BC1\u7C7B\u578B\u5B89\u5168\uFF08\u5F53\u7136\uFF0C\u8FD9\u662F\u9759\u6001\u5F3A\u7C7B\u578B\u8BED\u8A00\uFF09\u3002</p>
<p>TypeScript \u63D0\u4F9B\u4E86\u7C7B\u4F3C Rust \u679A\u4E3E\u7684\u6807\u7B7E\u8054\u5408\u7C7B\u578B\uFF08tagged union\uFF09\u3002\u901A\u5E38\u7684\u5B9E\u8DF5\u662F\uFF0C\u6BCF\u4E00\u4E2A\u5206\u91CF\uFF08variant\uFF09\u7528\u4E00\u4E2A\u5E38\u91CF\u6807\u7B7E\uFF08tag, discriminant\uFF09\u6807\u6CE8\u3002</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF"> | </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// &lt;- \u6807\u7B7E\u8054\u5408</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;A&quot;</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// &lt;- \u6807\u7B7E</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">valueA</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">; </span><span style="color: #7F848E; font-style: italic">// &lt;- \u5176\u4ED6\u6570\u636E</span></span>
<span class="line"><span style="color: #ABB2BF">} </span><span style="color: #7F848E; font-style: italic">// &lt;- \u5206\u91CF</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// ...</span></span>
<span class="line"></span></code></pre>
<p>TypeScript \u7684\u8054\u5408\uFF0C\u5E95\u5C42\u4ECD\u662F <code>Object</code> \u7C7B\u578B\uFF0C\u5206\u91CF\u7684\u7C7B\u578B\u5728\u7F16\u8BD1\u671F\u88AB\u64E6\u9664\uFF0C\u6240\u4EE5\u5728\u8FD0\u884C\u671F\u7684\u52A8\u6001\u6D3E\u53D1\u65F6\uFF0C\u9700\u8981\u5229\u7528\u5206\u91CF\u7684\u6807\u7B7E\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u4E00\u4E2A\u4ECE\u5206\u91CF\u6807\u7B7E\u5230\u8BE5\u5206\u91CF\u5BF9\u5E94\u7684\u5B9E\u73B0\u7684\u6620\u5C04\u3002</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">dispatch</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">A</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">variant</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">variant</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">valueA</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">B</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">getValue</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">variant</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">\`</span><span style="color: #C678DD">\${</span><span style="color: #E5C07B">variant</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">valueB</span><span style="color: #C678DD">}</span><span style="color: #98C379">\`</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  },</span></span>
<span class="line"><span style="color: #ABB2BF">};</span></span>
<span class="line"></span></code></pre>
<p>\u4F46\u662F\uFF0C\u5982\u4F55\u786E\u4FDD\u8FD9\u4E2A\u6620\u5C04\u662F\u7C7B\u578B\u5B89\u5168\u7684\u5462\uFF1F\u6709\u4E24\u4E2A\u95EE\u9898\u9700\u8981\u5173\u6CE8\uFF1A</p>
<ol>
<li>\u786E\u4FDD\u5206\u91CF\u7684\u6807\u7B7E\u548C\u5206\u91CF\u7684\u5B9E\u73B0\u662F\u7C7B\u578B\u5339\u914D\u7684\u3002\u4E5F\u5C31\u662F\u786E\u4FDD\u5728 <code>VariantA</code> \u4E0A\u8C03\u7528\u65F6\u4F1A\u88AB\u6D3E\u53D1\u5230 <code>Impl&lt;VariantA&gt;</code> \u7684\u5B9E\u73B0\u3002</li>
<li>\u6240\u6709\u5206\u91CF\u662F\u5426\u90FD\u6709\u5B8C\u6574\u4E14\u6B63\u786E\u7684\u5B9E\u73B0\uFF1F</li>
</ol>
<h2 id="\u6807\u7B7E\u6620\u5C04\u5230\u5B9E\u73B0" tabindex="-1">\u6807\u7B7E\u6620\u5C04\u5230\u5B9E\u73B0</h2>
<p>\u6807\u7B7E <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> \u548C\u5B9E\u73B0 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span> \u5B58\u5728\u4E8E\u503C\u7A7A\u95F4\uFF0C\u800C\u5206\u91CF <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span> \u53EA\u5B58\u5728\u4E8E\u7C7B\u578B\u7A7A\u95F4\uFF0C\u524D\u4E24\u8005\u90FD\u7531\u5206\u91CF\u7C7B\u578B\u786E\u5B9A\u3002\u56E0\u6B64\uFF0C\u4E3A\u4FDD\u8BC1\u6620\u5C04\u7684\u6B63\u786E\u6027\uFF0C\u9700\u8981\u904D\u5386\u8054\u5408\u7C7B\u578B\uFF0C\u8FD9\u5728 TypeScript \u4E2D\u5E94\u5F53\u4F7F\u7528\u6761\u4EF6\u7C7B\u578B\uFF08conditional type\uFF09\u3002\u8054\u5408\u7C7B\u578B\u5728\u6761\u4EF6\u7C7B\u578B\u4E2D\u4F1A\u88AB\u5C55\u5F00\u5E76\u9010\u4E00\u8BA1\u7B97\u7C7B\u578B\uFF0C\u5728\u8BA1\u7B97\u7ED3\u679C\u4E0A\u91CD\u65B0\u6C42\u8054\u5408\u3002</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">UnboxUnion</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Something</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">                   </span><span style="color: #7F848E; font-style: italic">// ^^^^^^^^^^^^^</span></span>
<span class="line"><span style="color: #ABB2BF">                   </span><span style="color: #7F848E; font-style: italic">//                 ^^^^^^^^^^^^</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">BoxUnion</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Something</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// UnboxUnion&lt;A | B&gt; == Something&lt;A&gt; | Something&lt;B&gt;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// BoxUnion&lt;A | B&gt; == Something&lt;A|B&gt;</span></span>
<span class="line"></span></code></pre>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DispatchUnion</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> { [</span><span style="color: #E5C07B">_</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Discriminant</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;]: </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; } </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">; </span></span>
<span class="line"></span></code></pre>
<p>\u5176\u4E2D\u7D22\u5F15\u5904\u7684 <code>[_ in Discriminant&lt;T&gt;]</code> \u7528\u4E8E\u5B57\u9762\u91CF\u7C7B\u578B\u8F6C\u6362\u4E3A\u503C\u3002\u5F53\u8054\u5408\u7C7B\u578B\u4F5C\u4E3A <code>DispatchUnion</code> \u7684\u7C7B\u578B\u53C2\u6570\u65F6\uFF0C\u6BCF\u4E00\u79CD\u7C7B\u578B\u4F1A\u5206\u522B\u53C2\u4E0E\u8FD0\u7B97\uFF08\u5C55\u5F00\uFF1F\uFF09\uFF0C\u56E0\u4E3A\u8FD9\u91CC\u6CDB\u578B <code>T</code> \u5E76\u6CA1\u6709\u88AB\u5305\u88C5\u5728\u5176\u4ED6\u7C7B\u578B\u5185\u3002</p>
<p>\u56E0\u6B64\u786E\u4FDD <code>Discriminant&lt;T&gt;</code> \u548C <code>Impl&lt;T&gt;</code> \u7684\u7C7B\u578B\u53C2\u6570\u59CB\u7EC8\u4E00\u81F4\u3002\u4F46\u5F97\u5230\u7684\u7ED3\u679C\u4ECD\u7136\u662F <code>|</code> \u8FDE\u63A5\u7684\u591A\u4E2A\u8054\u5408\u7C7B\u578B\uFF1A</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">_</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">DispatchUnion</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt;; </span><span style="color: #7F848E; font-style: italic">// \u7B49\u4E8E...</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">_</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">A</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF">&gt; } | { </span><span style="color: #E06C75">B</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">&gt; }</span></span>
<span class="line"><span style="color: #ABB2BF">                            </span><span style="color: #7F848E; font-style: italic">// ^ \u9519\u8BEF\u7684</span></span>
<span class="line"></span></code></pre>
<p>\u800C\u6211\u4EEC\u60F3\u8981\u7684\u662F\u8FD9\u4E9B\u7C7B\u578B\u7684\u4EA4\u96C6\u7C7B\u578B\uFF08intersection\uFF09\u2014\u2014\u786E\u4FDD\u6240\u6709\u5206\u91CF\u7684\u5B9E\u73B0\u90FD\u662F\u5B8C\u6574\u4E14\u6B63\u786E\u7684\u3002</p>
<h2 id="\u9006\u53D8" tabindex="-1">\u9006\u53D8</h2>
<p>\u5982\u4F55\u4ECE\u8054\u5408\u7C7B\u578B\u53D8\u4E3A\u4EA4\u96C6\u7C7B\u578B\uFF1F\u8FD9\u91CC\u5C31\u9700\u8981\u7528\u5230\u9006\u53D8\uFF08contravariant\uFF09\u3002</p>
<p>\u51FD\u6570\u7684\u53C2\u6570\u4F4D\u7F6E\u5C31\u662F\u53D1\u751F\u9006\u53D8\u7684\u4E00\u4E2A\u4F8B\u5B50\u3002\u8BBE <code>F&lt;T&gt;</code> \u8868\u793A <code>(_: T): any</code>\uFF0C\u5219\u6709\u5982\u4E0B Venn \u56FE\u3002</p>
<p><svg version="1.1" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><text x="187.10776" y="129.28905" fill="currentColor" font-family="sans-serif" font-size="40px" style="line-height:1.25" xml:space="preserve"><tspan x="187.10776" y="129.28905"/></text><g transform="translate(.90005 -.60281)"></g><g transform="translate(-.60867 -13.546)"><circle cx="100.76" cy="132.93" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><circle cx="178.41" cy="132.93" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><path d="m140.03 81.595a64.485 64.485 0 0 0-25.787 51.377 64.485 64.485 0 0 0 25.662 51.283 64.485 64.485 0 0 0 25.662-51.283 64.485 64.485 0 0 0-25.537-51.377z" fill="currentColor" fill-opacity=".25"/><text x="69.916725" y="141.68504" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="69.916725" y="141.68504" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T</tspan></text><text x="213.31772" y="141.56505" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="213.31772" y="141.56505" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">U</tspan></text><text x="140.00302" y="238.37758" fill="currentColor" font-family="sans-serif" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="140.00302" y="238.37758" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T&amp;U</tspan></text></g><g transform="translate(-.60867 -13.029)"><circle cx="334.81" cy="131.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><circle cx="412.46" cy="131.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><path d="m334.27 66.723a64.485 64.485 0 0 0-64.484 64.484 64.485 64.485 0 0 0 64.484 64.486 64.485 64.485 0 0 0 38.824-13.201 64.485 64.485 0 0 0 38.824 13.201 64.485 64.485 0 0 0 64.484-64.486 64.485 64.485 0 0 0-64.484-64.484 64.485 64.485 0 0 0-38.699 13.107 64.485 64.485 0 0 0-38.949-13.107z" fill="currentColor" fill-opacity=".25"/><text x="303.96799" y="139.968" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="303.96799" y="139.968" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T</tspan></text><text x="447.36899" y="139.84801" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="447.36899" y="139.84801" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">U</tspan></text><text x="374.05429" y="236.66054" fill="currentColor" font-family="sans-serif" font-size="24px" text-align="center" text-anchor="middle" style="line-height:1.25" xml:space="preserve"><tspan x="374.05429" y="236.66054" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T|U</tspan></text></g><circle cx="102.61" cy="352.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><circle cx="180.26" cy="352.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><path d="m141.88 300.88a64.485 64.485 0 0 0-25.787 51.377 64.485 64.485 0 0 0 25.662 51.283 64.485 64.485 0 0 0 25.662-51.283 64.485 64.485 0 0 0-25.537-51.377z" fill="currentColor" fill-opacity=".25"/><g fill="currentColor" font-size="24px"><text x="75.765312" y="360.97333" font-family="var(--font-mono)" style="line-height:1.25" xml:space="preserve"><tspan x="75.765312" y="360.97333" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&gt;</tspan></text><text x="207.16631" y="360.97333" font-family="var(--font-mono)" style="line-height:1.25" xml:space="preserve"><tspan x="207.16631" y="360.97333" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;U&gt;</tspan></text><text x="141.3116" y="457.66583" font-family="sans-serif" style="line-height:1.25" xml:space="preserve"><tspan x="141.3116" y="457.66583" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T|U&gt;</tspan></text></g><g transform="translate(.90005 -11.226)"><circle cx="330.84" cy="364.64" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><circle cx="408.49" cy="364.64" r="64.485" fill="none" stroke="currentColor" stroke-width="4"/><path d="m330.3 300.15a64.485 64.485 0 0 0-64.484 64.484 64.485 64.485 0 0 0 64.484 64.486 64.485 64.485 0 0 0 38.824-13.201 64.485 64.485 0 0 0 38.824 13.201 64.485 64.485 0 0 0 64.484-64.486 64.485 64.485 0 0 0-64.484-64.484 64.485 64.485 0 0 0-38.699 13.107 64.485 64.485 0 0 0-38.949-13.107z" fill="currentColor" fill-opacity=".25"/><text x="304.00198" y="373.3992" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="304.00198" y="373.3992" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&gt;</tspan></text><text x="437.40298" y="373.27921" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="437.40298" y="373.27921" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;U&gt;</tspan></text><text x="369.54831" y="470.09174" fill="currentColor" font-family="sans-serif" font-size="24px" text-align="center" text-anchor="middle" style="line-height:1.25" xml:space="preserve"><tspan x="369.54831" y="470.09174" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&amp;U&gt;</tspan></text></g></svg></p>
<p>\u80FD\u770B\u51FA\u6765\u201C\u9006\u201D\uFF0C\u4F46\u7406\u89E3\u4E0D\u80FD\uFF1F\u7528\u96C6\u5408\u6765\u8868\u793A\uFF1A</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi><mo stretchy="false">)</mo><mo>\u222A</mo><mo stretchy="false">(</mo><mi>U</mi><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo>\u222A</mo><mi>U</mi><mo stretchy="false">)</mo><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi><mo stretchy="false">)</mo><mo>\u2229</mo><mo stretchy="false">(</mo><mi>U</mi><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo>\u2229</mo><mi>U</mi><mo stretchy="false">)</mo><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\\begin{aligned}
(T \\times \\Omega) \\cup (U \\times \\Omega) &amp;= (T \\cup U) \\times \\Omega \\\\
(T \\times \\Omega) \\cap (U \\times \\Omega) &amp;= (T \\cap U) \\times \\Omega
\\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u222A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2229</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span><span class="mclose">)</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u222A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2229</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">\u03A9</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>\u800C</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo>\u2208</mo><mi>T</mi><mo>\u222A</mo><mi>U</mi><mo>\u21D2</mo><mi>x</mi><mo>\u2208</mo><mi>T</mi><mo>\u2228</mo><mi>x</mi><mo>\u2208</mo><mi>U</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo>\u2208</mo><mi>T</mi><mo>\u2229</mo><mi>U</mi><mo>\u21D2</mo><mi>x</mi><mo>\u2208</mo><mi>T</mi><mo>\u2227</mo><mi>x</mi><mo>\u2208</mo><mi>U</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\\begin{aligned}
x \\in T \\cup U \\Rightarrow x \\in T \\lor x \\in U \\\\
x \\in T \\cap U \\Rightarrow x \\in T \\land x \\in U
\\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u222A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u21D2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2228</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2229</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u21D2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2227</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">\u2208</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span><span class="vlist-s">\u200B</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>\u6240\u4EE5\uFF0C\u5728\u6211\u4EEC\u7684\u7C7B\u578B\u6807\u6CE8\u4E2D\uFF0C<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>\u222A</mo><mi>U</mi><mo stretchy="false">)</mo><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi></mrow><annotation encoding="application/x-tex">(T \\cup U) \\times \\Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u222A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">\u03A9</span></span></span></span> \u88AB\u8BB0\u4F5C <code>F&lt;T|U&gt;</code>\uFF0C\u800C <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>\u2229</mo><mi>U</mi><mo stretchy="false">)</mo><mo>\xD7</mo><mi mathvariant="normal">\u03A9</mi></mrow><annotation encoding="application/x-tex">(T \\cap U) \\times \\Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\u2229</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">\xD7</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">\u03A9</span></span></span></span> \u88AB\u8BB0\u4F5C <code>F&lt;T&amp;U&gt;</code>\u3002\u6240\u4EE5 <code>F&lt;T&gt;</code> \u548C <code>F&lt;U&gt;</code> \u7684\u4EA4\u96C6\u662F <code>F&lt;T|U&gt;</code>\uFF0C\u800C\u5E76\u96C6\u662F <code>F&lt;T&amp;U&gt;</code>\u3002</p>
<p>\u6240\u4EE5\uFF0C\u8981\u60F3\u4ECE <code>T|U</code> \u83B7\u5F97 <code>T&amp;U</code>\uFF0C\u4F60\u9700\u8981\uFF1A</p>
<ol>
<li>\u4ECE <code>T|U</code> \u83B7\u5F97 <code>F&lt;T&gt;|F&lt;U&gt;</code></li>
<li>\u4EE4 <code>F&lt;T&gt;</code> \u5E76 <code>F&lt;U&gt;</code> \u7684\u8BA1\u7B97\u7ED3\u679C\u4E3A <code>F&lt;R&gt;</code>\uFF0C\u63A8\u5BFC <code>R</code> \u7684\u7C7B\u578B\uFF0C<code>R</code> \u662F <code>T&amp;U</code></li>
</ol>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">StepOne</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">F</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Union</span><span style="color: #ABB2BF">&gt; </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">StepTwo</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">FuncUnion</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">FuncUnion</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">any</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FuncUnion</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">F</span><span style="color: #ABB2BF">&lt;infer </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF">&gt; </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">R</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">never</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span></code></pre>
<p>\u6CE8\u610F\u7B2C\u4E8C\u6B65\u4ECD\u7136\u9700\u8981\u4E0A\u6587\u7684\u5C55\u5F00\u6280\u5DE7\uFF0C\u56E0\u4E3A\u9700\u8981\u6839\u636E <code>F&lt;T&gt;</code> \u548C <code>F&lt;U&gt;</code> \u7684\u5E76\u8FD0\u7B97\u7684\u7ED3\u679C\u505A\u63A8\u65AD\uFF0C\u800C\u4E0D\u662F\u5728 <code>F&lt;T&gt;|F&lt;U&gt;</code> \u7C7B\u578B\u4E0A\u505A\u63A8\u65AD\u3002<strong>\u5982\u679C\u4E0D\u5C55\u5F00\uFF0CTypeScript \u4F1A\u628A\u8054\u5408\u7C7B\u578B\u89C6\u4F5C\u4E00\u4E2A\u6574\u4F53</strong>\u3002</p>
<h2 id="\u6CDB\u578B\u64E6\u9664" tabindex="-1">\u6CDB\u578B\u64E6\u9664</h2>
<p>\u5F97\u5230\u7684\u4EA4\u96C6\u7C7B\u578B\uFF0C\u5C31\u662F\u6211\u4EEC\u8981\u7684\u4ECE\u5206\u91CF\u6807\u7B7E\u5230\u8BE5\u5206\u91CF\u5BF9\u5E94\u7684\u5B9E\u73B0\u7684\u6620\u5C04\u7684\u7C7B\u578B\u3002\u4F46\u8FD8\u6709\u4E00\u4E2A\u5C0F\u95EE\u9898\uFF1A\u53D8\u6210\u4E86\u5F7B\u5E95\u7684\u9759\u6001\u6D3E\u53D1\u3002\u800C\u6211\u4EEC\u6700\u7EC8\u60F3\u8981\u7684\u662F\u52A8\u6001\u6D3E\u53D1\uFF0C\u5373\u8FD0\u884C\u65F6\u4F20\u5165\u4E00\u4E2A\u52A8\u6001\u7684\u6807\u7B7E\u8054\u5408\u7C7B\u578B\uFF0C\u6D3E\u53D1\u5230\u6B63\u786E\u7684\u5B9E\u73B0\uFF0C\u800C\u4E0D\u662F\u4F20\u5165\u4E00\u4E2A\u5177\u4F53\u7684\u5206\u91CF\uFF0C\u5728\u7F16\u8BD1\u671F\u786E\u5B9A\u6B63\u786E\u7684\u5B9E\u73B0\u3002</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">a</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VariantA</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">b</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">VariantB</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">declare</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">u</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">implA</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dispatch</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">a</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// Impl&lt;A&gt;</span></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">implB</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dispatch</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">b</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// Impl&lt;B&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">let</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">implU</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dispatch</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">u</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">]; </span><span style="color: #7F848E; font-style: italic">// Impl&lt;A&gt; | Impl&lt;B&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">// implU.getValue(?) &lt;- \u8FD9\u91CC\u7684 ? \u5E94\u8BE5\u662F\u4EC0\u4E48\u7C7B\u578B\uFF1F\u7F16\u8BD1\u671F\u65E0\u6CD5\u786E\u5B9A\uFF01</span></span>
<span class="line"></span></code></pre>
<p>\u6240\u4EE5\uFF0C\u6211\u4EEC\u9700\u8981\u4E00\u4E2A <code>(_: MyUnion): Impl&lt;MyUnion&gt;</code> \u7C7B\u578B\u7684\u51FD\u6570\u6765\u5B9E\u73B0\u52A8\u6001\u6D3E\u53D1\u3002\u5177\u4F53\u5B9E\u73B0\u975E\u5E38\u7B80\u5355\uFF0C\u5BF9\u4E8E\u4EFB\u4F55\u4E00\u4E2A <code>MyUnion</code> \u7C7B\u578B\u7684\u503C\uFF08\u53EF\u80FD\u662F\u4EFB\u4F55\u4E00\u4E2A\u5206\u91CF\uFF09\uFF0C\u53D6\u5176\u6807\u7B7E\u4F5C\u4E3A\u4E0B\u6807\uFF0C\u6211\u4EEC\u6784\u9020\u7684 <code>Dispatch&lt;MyUnion&gt;</code> \u5C06\u5B83\u6620\u5C04\u5230\u7684\u503C\u4E00\u5B9A\u662F\u5176\u5206\u91CF\u5BF9\u5E94\u7684 <code>Impl</code>\u3002\u800C\u6211\u4EEC\u7684\u9759\u6001\u6D3E\u53D1\u662F <code>&lt;T extends MyUnion&gt;(_: T): Impl&lt;T&gt;</code>\u3002\u6240\u4EE5\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u628A\u6240\u6709\u7684\u6CDB\u578B <code>T</code> \u5168\u90E8\u64E6\u9664\u4E3A\u52A8\u6001\u7684 <code>MyUnion</code> \u5373\u53EF\u3002</p>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">dynamic_dispatch</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">union</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">dispatch</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">union</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">kind</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Impl</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">MyUnion</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p><s>\u597D\u9EBB\u70E6\uFF0C\u8FD8\u4E0D\u5982\u7528 Rust \u{1F923}</s>\u3002\u4EE5\u53CA\uFF0C\u7531\u4E8E\u6CA1\u6709 HKT\uFF0C\u8FD9\u91CC\u7684 <code>Discriminant</code> \u548C <code>Dispatch</code> \u4E24\u4E2A\u6CDB\u578B\u6BCF\u6B21\u90FD\u9700\u8981\u91CD\u65B0\u5B9E\u73B0\u4E00\u4EFD\uFF0C<s>\u8FD8\u4E0D\u5982\u7528 Rust/C++</s>\uFF0C<s>\u4F60\u7684\u952E\u76D8\u4E0D\u662F\u6709 Ctrl, C, V \u4E09\u4E2A\u952E\u5417</s>\u3002</p>
</div>`})}}};export{m as category,y as date,A as default,F as keywords,g as tags,i as title};
