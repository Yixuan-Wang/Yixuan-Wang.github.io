<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/pwa-192x192.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script type="module" async="" crossorigin="" src="/assets/app.cd3cd70d.js"></script><link rel="modulepreload" href="/assets/vendor.68320762.js"><style>button[data-v-206fdd9c]{padding:.25rem;font-size:1.125rem;line-height:1.75rem;color:var(--color-accent)}button[data-v-206fdd9c]:hover{color:var(--color-secondary)}#app{display:grid;grid-template-rows:auto 1fr auto;grid-template-columns:100%;margin-left:1rem;margin-right:1rem;height:100%}@media (min-width:1024px){#app{margin-left:0;margin-right:0}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}h1,h2{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}button{font-family:inherit;font-size:100%;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}button{-webkit-appearance:button;background-color:transparent;background-image:none}blockquote,h1,h2,p,pre{margin:0}ul{list-style:none;margin:0;padding:0}button{cursor:pointer}svg{display:block;vertical-align:middle}.my-4{margin-top:1rem;margin-bottom:1rem}.mb-8{margin-bottom:2rem}.mt-4{margin-top:1rem}.inline-block{display:inline-block}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{grid-gap:.25rem;gap:.25rem}.gap-2{grid-gap:.5rem;gap:.5rem}.gap-3{grid-gap:.75rem;gap:.75rem}.gap-x-1{grid-column-gap:.25rem;column-gap:.25rem}.gap-y-0\.5{grid-row-gap:.125rem;row-gap:.125rem}.rounded{border-radius:.25rem}.bg-acc,.hover\:bg-acc:hover{background-color:var(--color-accent)}.hover\:bg-sec:hover{background-color:var(--color-secondary)}.\!px-0{padding-left:0!important;padding-right:0!important}.px-2{padding-left:.5rem;padding-right:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.text-left{text-align:left}.font-mono{font-family:var(--font-mono)}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.hover\:text-acc:hover,.text-acc{color:var(--color-accent)}.hover\:text-bgd:hover,.text-bgd{color:var(--color-background)}.text-dim{color:var(--color-dim)}.text-sec{color:var(--color-secondary)}.ring-2{--un-ring-offset-shadow:0 0 #0000;--un-ring-shadow:0 0 #0000;--un-shadow-inset:var(--un-empty, );/*!*//*!*/--un-shadow:0 0 #0000;--un-ring-inset:var(--un-empty, );/*!*//*!*/--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,0.5)}.ring-2{--un-ring-width:2px;--un-ring-offset-shadow:var(--un-ring-inset) 0 0 0 var(--un-ring-offset-width) var(--un-ring-offset-color);--un-ring-shadow:var(--un-ring-inset) 0 0 0 calc(var(--un-ring-width) + var(--un-ring-offset-width)) var(--un-ring-color);box-shadow:var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow,0 0 #0000)}.ring-acc{--un-ring-color:var(--color-accent)}.ring-fgd{--un-ring-color:var(--color-foreground)}.ring-sec{--un-ring-color:var(--color-secondary)}.ring-inset{--un-ring-inset:inset}:root{--color-accent:#003A70;--color-secondary:#61649f;--color-background:#F5F5F5;--color-foreground:#1D252D;--color-dim:#737C7B;--font-sans:"Noto Sans","SF Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Avenir Next","Helvetica Neue",sans-serif;--font-serif:"Noto Serif","New York","Roboto Slab",Cambria,Georgia,Times,"Times New Roman",serif;--font-mono:"JetBrains Mono","SF Mono","Roboto Mono",Menlo,"Cascadia Code",Consolas,monospace}html{height:100%;margin:0;padding:0;text-align:center;font-size:1rem;line-height:1.5rem;overflow:auto;overflow:overlay;background-color:var(--color-background);color:var(--color-foreground);font-family:var(--font-sans)}html:not(.dark) .shiki-dark{display:none}body{height:100%;margin:auto;padding:0;max-width:75ch}svg{width:1.25em;height:1.25em;display:inline;vertical-align:sub}h1{font-size:1.875rem;line-height:2.25rem;font-weight:700}button{outline:2px solid transparent!important;outline-offset:2px!important}.transition-lively,button{-webkit-transition-property:background-color,border-color,color,fill,stroke,opacity,-webkit-box-shadow,-webkit-transform,filter,backdrop-filter;-o-transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,-webkit-box-shadow,transform,-webkit-transform,filter,backdrop-filter;-webkit-transition-timing-function:cubic-bezier(.4,0,1,1);-o-transition-timing-function:cubic-bezier(.4,0,1,1);transition-timing-function:cubic-bezier(.4,0,1,1);-webkit-transition-duration:.2s;-o-transition-duration:.2s;transition-duration:.2s}.transition-lively:hover,button:hover{-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);-o-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1);-webkit-transition-duration:.3s;-o-transition-duration:.3s;transition-duration:.3s}#md a{text-decoration-skip-ink:auto;color:var(--color-accent);transition:all .2s ease-in}#md a:hover{color:var(--color-secondary);transition:all .3s ease-out}#md h2{margin:1.25em 0 .75em;font-family:var(--font-serif);font-weight:700}#md h2{font-size:1.5em}#md p{margin:1em 0}#md h2:first-child,#md p:first-child,#md pre:first-child{margin-top:0}#md h2:last-child,#md p:last-child,#md pre:last-child{margin-bottom:0}#md a{text-decoration:underline;text-decoration-skip-ink:auto}#md ul{margin:1em 0;padding-left:1em}#md ul{list-style:disc}#md li{line-height:150%;margin:.25em 0}#md blockquote{border-left:4px solid var(--color-foreground);padding-left:1em;margin-left:0;margin-top:0}#md blockquote p{margin-bottom:0}#md pre pre{border-radius:.25rem;padding:1em;max-width:100%;overflow:auto}#md code,#md pre{font-family:var(--font-mono);line-height:154%}#md pre{margin:1em 0}#md .katex{font-size:1em}</style><link rel="preload" href="/assets/app.c495ff01.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/dsa_kmp.23118809.js"><link rel="preload" href="/assets/dsa_kmp.40a2edf0.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/TheArticle.3f15bef1.js"><link rel="preload" href="/assets/TheArticle.25f0d059.css" as="style"><title>KMP 算法 | Pak</title><meta name="description" content="KMP 算法是利用重复片段进行优化的，无回溯的字符串匹配算法。"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous"><meta name="head:count" content="2"></head><body><div id="app" data-server-rendered="true"><!--[--><header class="flex justify-between items-center my-4 gap-2" data-v-206fdd9c=""><nav class="inline-block px-2 py-1 rounded bg-acc text-bgd font-bold transition-lively hover:(bg-sec)" data-v-206fdd9c=""><a href="/" class="" data-v-206fdd9c="">Pak</a></nav><nav class="flex justify-between items-center gap-3" data-v-206fdd9c=""><button data-v-206fdd9c=""><a href="/archive" class="" data-v-206fdd9c=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-206fdd9c=""><path d="M14 17H7v-2h7m3-2H7v-2h10m0-2H7V7h10m2-4H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" fill="currentColor"></path></svg></a></button><button data-v-206fdd9c=""><a href="/posts" class="" data-v-206fdd9c=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-206fdd9c=""><path d="M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6z" fill="currentColor"></path></svg></a></button><button data-v-206fdd9c=""><a href="/sheets" class="" data-v-206fdd9c=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-206fdd9c=""><path d="M4 3h16a2 2 0 0 1 2 2v15a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v3h4V7H4m6 0v3h4V7h-4m10 3V7h-4v3h4M4 12v3h4v-3H4m0 8h4v-3H4v3m6-8v3h4v-3h-4m0 8h4v-3h-4v3m10 0v-3h-4v3h4m0-8h-4v3h4v-3z" fill="currentColor"></path></svg></a></button><button data-v-206fdd9c=""><a href="/notes" class="" data-v-206fdd9c=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" data-v-206fdd9c=""><path d="M14 10V4.5l5.5 5.5M5 3c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9l-6-6H5z" fill="currentColor"></path></svg></a></button></nav></header><main class="text-left"><main class="mb-8"><article class="text-left"><!--[--><header class="flex flex-col justify-start items-start gap-2 mt-4 mb-8"><h1>KMP 算法</h1><div class="flex flex-wrap gap-x-1 gap-y-0.5 justify-start items-center"><span class="flex justify-center text-lg"><a href="/posts" class=""><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" class="transition-lively hover:text-acc"><path d="M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6z" fill="currentColor"></path></svg></a></span><span class="flex gap-1 justify-center items-center"><span class="inline-block text-xs rounded px-2 py-1 font-mono font-bold transition-lively ring-inset ring-2 ring-fgd"><!--[--><time>06/11/2020</time><!--]--></span><span class="inline-block text-xs rounded px-2 py-1 font-mono font-bold transition-lively ring-inset ring-2 ring-fgd"><!--[-->zh-Hans<!--]--></span></span><span class="flex gap-1 justify-center items-center"><span class="inline-block text-xs rounded px-2 py-1 font-mono font-bold transition-lively ring-inset ring-2 ring-acc text-acc hover:bg-acc hover:text-bgd"><!--[--><a href="/categories/comp" class="">Computer</a><!--]--></span></span><span class="flex gap-1 justify-center items-center"><!--[--><span class="inline-block text-xs rounded px-2 py-1 font-mono font-bold transition-lively ring-inset ring-2 ring-sec text-sec hover:bg-sec hover:text-bgd"><!--[--><a href="/tags?tag=dsa" class=""> @dsa</a><!--]--></span><!--]--></span><span class="flex gap-1 justify-center items-center"><!--[--><span class="inline-block text-xs rounded px-2 py-1 font-mono font-bold transition-lively text-dim !px-0"><!--[--><span> #string</span><!--]--></span><!--]--></span></div></header><section id="md"><div><p>KMP 算法是利用重复片段进行优化的，无回溯的字符串匹配算法。</p><!-- more --><p><strong>更新</strong>（2021-10-14）：修正了预处理计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 时未进行递推处理的错误。</p><h2 id="回溯" tabindex="-1">回溯</h2><blockquote><p>TL;DR | 暴力算法中存在不必要的<strong>向左回退</strong>比较。</p></blockquote><p><strong>暴力</strong>的字符串匹配算法会遇到回溯的情况，如下所示：</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abc

    ababc
  1|^
  2|a^
! 3|ab^
! 4| ^
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abc

    ababc
  1|^
  2|a^
! 3|ab^
! 4| ^
</span></span></code></pre></div></code></pre><p>用<strong>模式串</strong>abc 匹配<strong>目标串</strong>ababc，在第 3 步中，先将模式串第 0 位对齐目标串第 0 位，模式串的前两位匹配成功，第 2 位匹配失败(3)，因此将模式串的第零位移动到目标串第 1 位重新对齐(4)，因而比较的位置<strong>回溯</strong>了，但由于(2)用模式串第 1 位 b 匹配目标串第 1 位 b 成功，(4)用模式串第 0 位 a 重新匹配目标串第 1 位必定失败，因此这样的回溯是妨害效率的。主要原因是，在回溯的过程中，原有的匹配成功信息没有被利用即被丢弃。</p><p>设模式串长度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span>，目标串长度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span>，最坏情况是每次都在模式串的最后一位匹配失败，即匹配<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span>次后失败，一直比较到模式串和目标串右对齐，模式串的第零位对齐在目标串第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n-m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span>位，一共比较<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mi>m</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-m+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>次。由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≥</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \ge m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7719400000000001em;vertical-align:-.13597em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span>，因而最坏时间复杂度是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(mn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p><h2 id="kmp-算法" tabindex="-1">KMP 算法</h2><blockquote><p>TL;DR | KMP 算法利用了模式串中<strong>重复</strong>的片段，通过<strong>对齐</strong>这些片段实现不向左后退。</p></blockquote><p>暴力算法中，每次在模式串第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>位和目标串第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span>位匹配失败以后，模式串左端总是向右移动 1 位。而****KMP 算法****的思路是，根据模式串的某种规律（将在下文分析），得出一个对应关系<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">next</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.61508em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span></span></span></span>，使得在模式串第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>位和目标串第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span>位匹配失败以后，使得模式串的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>位和目标串<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span>位对齐，即模式串左端向右移动<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">i-next(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.74285em;vertical-align:-.08333em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>位，<strong>避免发生回溯</strong>。分析以下操作的例子：</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abcdabd

    0   45
    abcdaabcda
! 1|abcda^
  2|    a^
    *   *

    01  456
    abcdabcdabd
! 3|abcdab^
  4|    ab^
    **  **
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abcdabd

    0   45
    abcdaabcda
! 1|abcda^
  2|    a^
    *   *

    01  456
    abcdabcdabd
! 3|abcdab^
  4|    ab^
    **  **
</span></span></code></pre></div></code></pre><p>先看<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo mathvariant="normal">≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i\ne0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>时的情况。</p><p>对于模式串<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span></span></span></span>匹配失败的第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>位<strong>之前的</strong>部分，即子串<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>p</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup><mo>=</mo><msub><mi>p</mi><mn>0</mn></msub><msub><mi>p</mi><mn>1</mn></msub><mo>…</mo><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p'_{i}=p_0 p_1 \dots p_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.010556em;vertical-align:-.258664em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.751892em"><span style="top:-2.441336em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.258664em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span>，我们希望找到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>p</mi><mi>i</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msubsup></mrow><annotation encoding="application/x-tex">p'_{i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.010556em;vertical-align:-.258664em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.751892em"><span style="top:-2.441336em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.258664em"><span></span></span></span></span></span></span></span></span></span>中<strong>最长</strong>的一对<strong>完全相同</strong>的<strong>前缀和后缀</strong>，并把它的长度记作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>，即：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mn>0</mn></msub><msub><mi>p</mi><mn>1</mn></msub><mo>…</mo><msub><mi>p</mi><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub></mrow></msub><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><msub><mi>k</mi><mi>i</mi></msub><mo>+</mo><mn>1</mn></mrow></msub><mo>…</mo><msub><mi>p</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p_0 p_1 \dots p_{k_i-1} = p_{i-k_i} p_{i-k_i+1} \dots p_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68066em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68066em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="minner">…</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span></span></p><p>并通过移位使得<strong>前缀左端</strong>移到原来<strong>后缀左端</strong>对应的位置，可以得到：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mi>i</mi></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">next(i) = k_i\tag{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p><p>如果找不到符合上述要求的一对前缀和后缀时，将模式串的左端直接对齐到匹配失败的一位即可。此时<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k_i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>，公式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>仍然成立。</p><p>如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>，也就是第 0 位已经匹配失败，则模式串的左端移到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.74285em;vertical-align:-.08333em"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>，继续比较。令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>0</mn></msub><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k_0=-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">−</span><span class="mord">1</span></span></span></span>，公式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>仍然成立，只是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">p_{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.638891em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.301108em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span></span></span></span>没有意义。课本上基于此点把这两个混在一起了，多循环了一次，个人觉得有点还是分开处理比较好理解。</p><p>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">j &lt; n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span>时如果找到目标串中匹配模式串的子串，即满足<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mi>m</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i=m-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>时匹配，则返回模式串左端位置<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>−</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">j-i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>。如果<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">j=n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span>，说明目标串中不存在匹配模式串的字串，返回表示搜索无结果的值。</p><p>在搜索过程中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span>不会减小（即不会发生回溯），递增的次数不会超过<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span>。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span></span></span></span>递增的同时，一定伴随着<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>递增，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>在匹配失败时也会减小，但最多减小到 0，减小的次数不会多于增加的次数，因此最终<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>递增的次数不会超过<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>n</mi></mrow><annotation encoding="application/x-tex">2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">2</span><span class="mord mathnormal">n</span></span></span></span>。所以，搜索部分的最坏时间复杂度是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p><h2 id="模式串的预处理" tabindex="-1">模式串的预处理</h2><blockquote><p>TL;DR | 通过递推的方法可以快速推出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>表，还可以再进行递归优化避免在移动模式串前后比较内容相同的情况。</p></blockquote><p>问题的关键转移到了计算<strong>最长相同前后缀长度</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>。这里利用递推会比较简单。</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abaaa

    0  1  2  3  4
    a  b  a  a  a
0| -1  0  0

 |  *     ^
1| -1  0  0-&gt;1

 |  *  *  ^  ^
2| -1  0  0  1-&gt;2

...
 |  *  *  !
 |        ^  ^  !
3| -1  0  0  1  2-&gt;0
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abaaa

    0  1  2  3  4
    a  b  a  a  a
0| -1  0  0

 |  *     ^
1| -1  0  0-&gt;1

 |  *  *  ^  ^
2| -1  0  0  1-&gt;2

...
 |  *  *  !
 |        ^  ^  !
3| -1  0  0  1  2-&gt;0
</span></span></code></pre></div></code></pre><p>初始条件(0)是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mn>0</mn></msub><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k_0=-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">−</span><span class="mord">1</span></span></span></span>。</p><p>递推时，首先验证<strong>上一次验证</strong>中前缀末尾的下一位（把这个位置记作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span>）和后缀末尾的下一位是否相等，如果相等（见上图），说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><msub><mi>k</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k_i = k_{i-1}+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.902771em;vertical-align:-.208331em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.208331em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">1</span></span></span></span>。如果不相等，相当于在前缀末尾的下一位（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span>）处<strong>失配</strong>，因此应移动到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span> 处（见下图的百分号处，也就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span></span></span></span> 变为了新的前缀末尾）继续尝试匹配，直至匹配成功，或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 迭代为负数。</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abaab

    0  1  2  3  4
    a  b  a  a  b
0| -1  0  0  1
 
 |  *  !  ^  !
1| -1  0  0  1-&gt;?
 |     %

 |  *        ^
2| -1  0  0  1-&gt;1
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abaab

    0  1  2  3  4
    a  b  a  a  b
0| -1  0  0  1
 
 |  *  !  ^  !
1| -1  0  0  1-&gt;?
 |     %

 |  *        ^
2| -1  0  0  1-&gt;1
</span></span></code></pre></div></code></pre><p>这样就得到了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">next</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.61508em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span></span></span></span>，但是还有优化的空间。</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abab
   a  b  a  b
k -1  0  0  1

    abaabab
! 1|aba^
! 2|  a^
  3|   ^
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abab
   a  b  a  b
k -1  0  0  1

    abaabab
! 1|aba^
! 2|  a^
  3|   ^
</span></span></code></pre></div></code></pre><p>在这个例子中，发现(1)匹配失败，(2)必定也匹配失败，两次比较的字符完全相同，多了一次无谓的比较，根本原因是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>j</mi></msub><mo mathvariant="normal">≠</mo><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><msub><mi>p</mi><msub><mi>k</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">s_j \ne p_{i}=p_{k_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.980548em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.311664em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.05724em">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68066em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span></span></span></span>，使得移动模式串后，比较的字符没有变，还需要再次移动。因此，可以对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">k_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>（当然也是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>）<strong>递推地优化</strong>：当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><msub><mi>p</mi><msub><mi>k</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">p_i = p_{k_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68066em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span></span></span></span>时，令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>i</mi></msub><mo>=</mo><msub><mi>k</mi><msub><mi>k</mi><mi>i</mi></msub></msub></mrow><annotation encoding="application/x-tex">k_i = k_{k_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.9445399999999999em;vertical-align:-.2501em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3280857142857143em"><span style="top:-2.357em;margin-left:-.03148em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2501em"><span></span></span></span></span></span></span></span></span></span> ，或者写作“令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(i) = next(next(i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>”，可能更方便理解。</p><p>对于上例，优化效果如下所示：</p><pre><code><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dee9ff">模式串 abab
    a  b  a  b
k  -1  0  0  1
k' -1  0 -1  0

    abaabab
! 1|aba^
  2|   ^
</span></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">模式串 abab
    a  b  a  b
k  -1  0  0  1
k' -1  0 -1  0

    abaabab
! 1|aba^
  2|   ^
</span></span></code></pre></div></code></pre><p>预处理过程中，对于递推部分的时间复杂度，外层循环中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 递增，内层循环中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 递减（恒有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">next(k) &lt; k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span>），由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k\ge0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.83041em;vertical-align:-.13597em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> 且其初值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span> 知递减总次数一定小于等于递增总次数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">m</span></span></span></span>；而优化中，由于优化到第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65952em;vertical-align:0"></span><span class="mord mathnormal">i</span></span></span></span>项时第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">next(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span>项已经优化过，因此无需递推。因此，预处理过程的时间复杂度是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span>。</p><h2 id="结论" tabindex="-1">结论</h2><blockquote><p>TL;DR | KMP 算法时间复杂度是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m+n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p></blockquote><p>综上，KMP 算法的时间复杂度是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m+n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，小于暴力算法的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(mn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。由于在实践中通常<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>≪</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m \ll n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≪</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span>，因此 KMP 算法的时间复杂度可以视为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。但是，由于 KMP 算法的优化基于重复片段，因此使用的字符集比较大时（比如汉语的字符集），重复片段出现的概率低，它的效率提升也有限。实践中，从尾部开始向左匹配并计算“坏字符”的另一个字符串匹配算法，BM 算法，效率更高，可以达到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，可以查看参考资料中的文章中的介绍。</p><h2 id="python-实现" tabindex="-1">Python 实现</h2><pre><code class="language-python"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#2e3440ff"><code><span class="line"><span style="color:#d8dEE9FF">NO_MATCH </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81a1c1">def</span><span style="color:#d8dEE9FF"> </span><span style="color:#88c0d0">kmp</span><span style="color:#eceff4">(</span><span style="color:#d8dee9">p</span><span style="color:#eceff4">,</span><span style="color:#d8dEE9FF"> </span><span style="color:#d8dee9">s</span><span style="color:#eceff4">):</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># pattern 模式串, string 目标串</span></span>
<span class="line"><span style="color:#d8dEE9FF">    m</span><span style="color:#eceff4">,</span><span style="color:#d8dEE9FF"> n </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#88c0d0">len</span><span style="color:#eceff4">(</span><span style="color:#d8dEE9FF">p</span><span style="color:#eceff4">),</span><span style="color:#d8dEE9FF"> </span><span style="color:#88c0d0">len</span><span style="color:#eceff4">(</span><span style="color:#d8dEE9FF">s</span><span style="color:#eceff4">)</span></span>
<span class="line"><span style="color:#d8dEE9FF">    i</span><span style="color:#eceff4">,</span><span style="color:#d8dEE9FF"> j </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">0</span><span style="color:#eceff4">,</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#616e88"># 预处理</span></span>
<span class="line"><span style="color:#d8dEE9FF">    nxt </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#eceff4">[</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># next 预处理表</span></span>
<span class="line"><span style="color:#d8dEE9FF">    k </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 上一次验证的前缀末尾</span></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#81a1c1">for</span><span style="color:#d8dEE9FF"> x </span><span style="color:#81a1c1">in</span><span style="color:#d8dEE9FF"> </span><span style="color:#88c0d0">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span><span style="color:#d8dEE9FF"> m</span><span style="color:#eceff4">):</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">while</span><span style="color:#d8dEE9FF"> k </span><span style="color:#81a1c1">&gt;=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">0</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">and</span><span style="color:#d8dEE9FF"> p</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">x</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">!=</span><span style="color:#d8dEE9FF"> p</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">k</span><span style="color:#eceff4">]:</span></span>
<span class="line"><span style="color:#d8dEE9FF">            k </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> nxt</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">k</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 在 k 处失配</span></span>
<span class="line"><span style="color:#d8dEE9FF">        k </span><span style="color:#81a1c1">+=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">1</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># k 处匹配成功，前缀长度可以递增 1</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">if</span><span style="color:#d8dEE9FF"> p</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">k</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">==</span><span style="color:#d8dEE9FF"> p</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">x</span><span style="color:#eceff4">]:</span></span>
<span class="line"><span style="color:#d8dEE9FF">            nxt</span><span style="color:#eceff4">.</span><span style="color:#88c0d0">append</span><span style="color:#eceff4">(</span><span style="color:#d8dEE9FF">nxt</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">k</span><span style="color:#eceff4">])</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 优化</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">else</span><span style="color:#eceff4">:</span><span style="color:#d8dEE9FF"> nxt</span><span style="color:#eceff4">.</span><span style="color:#88c0d0">append</span><span style="color:#eceff4">(</span><span style="color:#d8dEE9FF">k</span><span style="color:#eceff4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#616e88"># 比较</span></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#81a1c1">while</span><span style="color:#d8dEE9FF"> i </span><span style="color:#81a1c1">&lt;</span><span style="color:#d8dEE9FF"> m </span><span style="color:#81a1c1">and</span><span style="color:#d8dEE9FF"> j </span><span style="color:#81a1c1">&lt;</span><span style="color:#d8dEE9FF"> n</span><span style="color:#eceff4">:</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">if</span><span style="color:#d8dEE9FF"> p</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">i</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">==</span><span style="color:#d8dEE9FF"> s</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">j</span><span style="color:#eceff4">]:</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 匹配成功</span></span>
<span class="line"><span style="color:#d8dEE9FF">            i </span><span style="color:#81a1c1">+=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">1</span><span style="color:#d8dEE9FF">; j </span><span style="color:#81a1c1">+=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">1</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">else</span><span style="color:#eceff4">:</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 匹配失败</span></span>
<span class="line"><span style="color:#d8dEE9FF">            </span><span style="color:#81a1c1">if</span><span style="color:#d8dEE9FF"> nxt</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">i</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">==</span><span style="color:#d8dEE9FF"> </span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">:</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 向后移动1位</span></span>
<span class="line"><span style="color:#d8dEE9FF">                i </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">0</span><span style="color:#d8dEE9FF">; j </span><span style="color:#81a1c1">+=</span><span style="color:#d8dEE9FF"> </span><span style="color:#b48ead">1</span></span>
<span class="line"><span style="color:#d8dEE9FF">            </span><span style="color:#81a1c1">else</span><span style="color:#eceff4">:</span></span>
<span class="line"><span style="color:#d8dEE9FF">                i </span><span style="color:#81a1c1">=</span><span style="color:#d8dEE9FF"> nxt</span><span style="color:#eceff4">[</span><span style="color:#d8dEE9FF">i</span><span style="color:#eceff4">]</span><span style="color:#d8dEE9FF"> </span><span style="color:#616e88"># 将nxt[i]位置和j位置对齐</span></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#81a1c1">if</span><span style="color:#d8dEE9FF"> i </span><span style="color:#81a1c1">==</span><span style="color:#d8dEE9FF"> m</span><span style="color:#eceff4">:</span></span>
<span class="line"><span style="color:#d8dEE9FF">        </span><span style="color:#81a1c1">return</span><span style="color:#d8dEE9FF"> j </span><span style="color:#81a1c1">-</span><span style="color:#d8dEE9FF"> i </span><span style="color:#616e88"># 返回子串的左端</span></span>
<span class="line"><span style="color:#d8dEE9FF">    </span><span style="color:#81a1c1">return</span><span style="color:#d8dEE9FF"> NO_MATCH</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#0550ae">NO_MATCH</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#cf222e">def</span><span style="color:#24292f"> </span><span style="color:#8250df">kmp</span><span style="color:#24292f">(p, s): </span><span style="color:#6e7781"># pattern 模式串, string 目标串</span></span>
<span class="line"><span style="color:#24292f">    m, n </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">len</span><span style="color:#24292f">(p), </span><span style="color:#0550ae">len</span><span style="color:#24292f">(s)</span></span>
<span class="line"><span style="color:#24292f">    i, j </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">0</span><span style="color:#24292f">, </span><span style="color:#0550ae">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#6e7781"># 预处理</span></span>
<span class="line"><span style="color:#24292f">    nxt </span><span style="color:#cf222e">=</span><span style="color:#24292f"> [</span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span><span style="color:#24292f">] </span><span style="color:#6e7781"># next 预处理表</span></span>
<span class="line"><span style="color:#24292f">    k </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span><span style="color:#24292f"> </span><span style="color:#6e7781"># 上一次验证的前缀末尾</span></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#cf222e">for</span><span style="color:#24292f"> x </span><span style="color:#cf222e">in</span><span style="color:#24292f"> </span><span style="color:#0550ae">range</span><span style="color:#24292f">(</span><span style="color:#0550ae">1</span><span style="color:#24292f">, m):</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">while</span><span style="color:#24292f"> k </span><span style="color:#cf222e">&gt;=</span><span style="color:#24292f"> </span><span style="color:#0550ae">0</span><span style="color:#24292f"> </span><span style="color:#cf222e">and</span><span style="color:#24292f"> p[x</span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span><span style="color:#24292f">] </span><span style="color:#cf222e">!=</span><span style="color:#24292f"> p[k]:</span></span>
<span class="line"><span style="color:#24292f">            k </span><span style="color:#cf222e">=</span><span style="color:#24292f"> nxt[k] </span><span style="color:#6e7781"># 在 k 处失配</span></span>
<span class="line"><span style="color:#24292f">        k </span><span style="color:#cf222e">+=</span><span style="color:#24292f"> </span><span style="color:#0550ae">1</span><span style="color:#24292f"> </span><span style="color:#6e7781"># k 处匹配成功，前缀长度可以递增 1</span></span>
<span class="line"><span style="color:#24292f">        </span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">if</span><span style="color:#24292f"> p[k] </span><span style="color:#cf222e">==</span><span style="color:#24292f"> p[x]:</span></span>
<span class="line"><span style="color:#24292f">            nxt.append(nxt[k]) </span><span style="color:#6e7781"># 优化</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">else</span><span style="color:#24292f">: nxt.append(k)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#6e7781"># 比较</span></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#cf222e">while</span><span style="color:#24292f"> i </span><span style="color:#cf222e">&lt;</span><span style="color:#24292f"> m </span><span style="color:#cf222e">and</span><span style="color:#24292f"> j </span><span style="color:#cf222e">&lt;</span><span style="color:#24292f"> n:</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">if</span><span style="color:#24292f"> p[i] </span><span style="color:#cf222e">==</span><span style="color:#24292f"> s[j]: </span><span style="color:#6e7781"># 匹配成功</span></span>
<span class="line"><span style="color:#24292f">            i </span><span style="color:#cf222e">+=</span><span style="color:#24292f"> </span><span style="color:#0550ae">1</span><span style="color:#24292f">; j </span><span style="color:#cf222e">+=</span><span style="color:#24292f"> </span><span style="color:#0550ae">1</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">else</span><span style="color:#24292f">: </span><span style="color:#6e7781"># 匹配失败</span></span>
<span class="line"><span style="color:#24292f">            </span><span style="color:#cf222e">if</span><span style="color:#24292f"> nxt[i] </span><span style="color:#cf222e">==</span><span style="color:#24292f"> </span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span><span style="color:#24292f">: </span><span style="color:#6e7781"># 向后移动1位</span></span>
<span class="line"><span style="color:#24292f">                i </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">0</span><span style="color:#24292f">; j </span><span style="color:#cf222e">+=</span><span style="color:#24292f"> </span><span style="color:#0550ae">1</span></span>
<span class="line"><span style="color:#24292f">            </span><span style="color:#cf222e">else</span><span style="color:#24292f">:</span></span>
<span class="line"><span style="color:#24292f">                i </span><span style="color:#cf222e">=</span><span style="color:#24292f"> nxt[i] </span><span style="color:#6e7781"># 将nxt[i]位置和j位置对齐</span></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#cf222e">if</span><span style="color:#24292f"> i </span><span style="color:#cf222e">==</span><span style="color:#24292f"> m:</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">return</span><span style="color:#24292f"> j </span><span style="color:#cf222e">-</span><span style="color:#24292f"> i </span><span style="color:#6e7781"># 返回子串的左端</span></span>
<span class="line"><span style="color:#24292f">    </span><span style="color:#cf222e">return</span><span style="color:#24292f"> </span><span style="color:#0550ae">NO_MATCH</span></span>
<span class="line"></span></code></pre></div></code></pre><h2 id="参考资料" tabindex="-1">参考资料</h2><ul><li><a href="https://blog.csdn.net/v_july_v/article/details/7041827" target="_blank" rel="noopener">July，从头到尾彻底理解 KMP，2014</a></li><li>裘宗燕，数据结构与算法：Python 语言描述，2018</li></ul></div></section><!--]--></article></main></main><!----><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{}}'</script><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("color-schema")||"auto";("dark"===a||e&&"light"!==a)&&document.documentElement.classList.toggle("dark",!0)}()</script><link rel="stylesheet" href="/assets/app.c495ff01.css"><link rel="stylesheet" href="/assets/dsa_kmp.40a2edf0.css"><link rel="stylesheet" href="/assets/TheArticle.25f0d059.css"></body></html>