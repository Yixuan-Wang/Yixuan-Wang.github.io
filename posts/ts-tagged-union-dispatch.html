<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="apple-touch-icon" href="/pwa-192x192.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script type="module" async="" crossorigin="" src="/assets/app.e1fadd5b.js"></script><style>button[data-v-6ed7d32f]{padding:.25rem;font-size:1.125rem;line-height:1.75rem;color:rgba(var(--color-accent))}#app{display:grid;grid-template-rows:auto 1fr auto;grid-template-columns:100%;margin-left:1rem;margin-right:1rem;height:100%}@media (min-width:1024px){#app{margin-left:0;margin-right:0}}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}h1,h2{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}button{font-family:inherit;font-size:100%;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}button{-webkit-appearance:button;background-color:transparent;background-image:none}h1,h2,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}button{cursor:pointer}svg{display:block;vertical-align:middle}*,::after,::before{--un-rotate:0;--un-rotate-x:0;--un-rotate-y:0;--un-rotate-z:0;--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-skew-x:0;--un-skew-y:0;--un-translate-x:0;--un-translate-y:0;--un-translate-z:0;--un-scroll-snap-strictness:proximity;--un-border-spacing-x:0;--un-border-spacing-y:0;--un-ring-offset-shadow:0 0 rgba(0,0,0,0);--un-ring-shadow:0 0 rgba(0,0,0,0);--un-shadow:0 0 rgba(0,0,0,0);--un-ring-offset-width:0px;--un-ring-offset-color:#fff;--un-ring-width:0px;--un-ring-color:rgba(147,197,253,0.5)}.i-mdi-file,[i-mdi-file=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.25em' height='1.25em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M13 9V3.5L18.5 9M6 2c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6H6Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;display:inline-block;vertical-align:sub;width:1.25em;height:1.25em}[i-mdi-folder=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.25em' height='1.25em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M10 4H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-8l-2-2Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;display:inline-block;vertical-align:sub;width:1.25em;height:1.25em}[i-mdi-table-large=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.25em' height='1.25em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M4 3h16a2 2 0 0 1 2 2v15a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v3h4V7H4m6 0v3h4V7h-4m10 3V7h-4v3h4M4 12v3h4v-3H4m0 8h4v-3H4v3m6-8v3h4v-3h-4m0 8h4v-3h-4v3m10 0v-3h-4v3h4m0-8h-4v3h4v-3Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;display:inline-block;vertical-align:sub;width:1.25em;height:1.25em}[i-mdi-text-box=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' display='inline-block' vertical-align='sub' width='1.25em' height='1.25em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M14 17H7v-2h7m3-2H7v-2h10m0-2H7V7h10m2-4H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;display:inline-block;vertical-align:sub;width:1.25em;height:1.25em}[btn-icon=""]:hover{color:rgba(var(--color-accent));transition-duration:.3s;transition-timing-function:cubic-bezier(0,0,.2,1)}.transition-lively,[btn-icon=""],[transition-lively=""]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:.2s;transition-timing-function:cubic-bezier(.4,0,1,1)}.transition-lively:hover,[transition-lively=""]:hover{transition-duration:.3s;transition-timing-function:cubic-bezier(0,0,.2,1)}.relative{position:relative}.my-4{margin-top:1rem;margin-bottom:1rem}.mb-8,[m~=b-8]{margin-bottom:2rem}.mt-4{margin-top:1rem}.inline-block{display:inline-block}.flex{display:flex}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\.5{grid-gap:.125rem;gap:.125rem}.gap-1{grid-gap:.25rem;gap:.25rem}.gap-2{grid-gap:.5rem;gap:.5rem}.gap-3{grid-gap:.75rem;gap:.75rem}.gap-x-1{grid-column-gap:.25rem;column-gap:.25rem}.gap-y-0\.5{grid-row-gap:.125rem;row-gap:.125rem}.rounded{border-radius:.25rem}.hover\:bg-acc:hover,[bg~=acc]{background-color:rgba(var(--color-accent))}.hover\:bg-sec:hover,[bg~="hover\:sec"]:hover{background-color:rgba(var(--color-secondary))}[fill-opacity~="\.25"]{--un-fill-opacity:0.0025}[fill~=none]{fill:none}[stroke-width~="\34 "]{stroke-width:4px}.p-1{padding:.25rem}.px-2{padding-left:.5rem;padding-right:.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.text-left{text-align:left}.font-mono,[font~=mono]{font-family:var(--font-mono)}.text-xs{font-size:.75rem;line-height:1rem}.font-bold,[font~=bold]{font-weight:700}[color~="\#00aba9"]{--un-text-opacity:1;color:rgba(0,171,169,var(--un-text-opacity))}.text-acc{color:rgba(var(--color-accent))}.hover\:text-bgd:hover,[text~=bgd]{color:rgba(var(--color-background))}.hover\:text-sec:hover,.text-sec{color:rgba(var(--color-secondary))}.text-dim{color:rgba(var(--color-dim))}@media (min-width:1024px){.lg\:sticky{position:sticky}.lg\:top-4{top:1rem}}:root{--shiki-color-text:#EEEEEE;--shiki-color-background:#333333;--shiki-token-constant:#660000;--shiki-token-string:#770000;--shiki-token-comment:#880000;--shiki-token-keyword:#990000;--shiki-token-parameter:#AA0000;--shiki-token-function:#BB0000;--shiki-token-string-expression:#CC0000;--shiki-token-punctuation:#DD0000;--shiki-token-link:#EE0000}:root{--font-sans:"Noto Sans",var(--custom-font-sans, sans-serif),"SF Pro",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Avenir Next","Helvetica Neue",sans-serif;--font-serif:"Noto Serif",var(--custom-font-serif, serif),"Noto Serif","New York","Roboto Slab",Cambria,Georgia,Times,"Times New Roman",serif;--font-mono:"JetBrains Mono","SF Mono","Roboto Mono",Menlo,"Cascadia Code",Consolas,monospace}html:not(.dark){--color-accent-default:33,119,184;--color-accent:var(--accent-light-accent, var(--color-accent-default));--color-secondary-default:0,58,112;--color-secondary:var(--accent-light-secondary, var(--color-secondary-default));--color-background:245,245,245;--color-foreground:29,37,45;--color-dim:115,125,124}html{height:100%;width:100%;margin:0;padding:0;text-align:center;font-size:1rem;line-height:1.5rem;overflow-x:hidden;overflow-y:auto;overflow-y:overlay;background-color:rgba(var(--color-background));color:rgba(var(--color-foreground));font-family:var(--font-sans)}body{height:100%;margin:auto;padding:0;max-width:75ch}code,pre{font-family:var(--font-mono)}h1{font-size:1.875rem;line-height:2.25rem;font-weight:700}button{outline:2px solid transparent!important;outline-offset:2px!important}#md a{color:rgba(var(--color-accent));background-color:rgba(var(--color-accent),.125);border-radius:.25rem;padding:.125rem .5ch;transition:all .2s ease-in}#md a:hover{color:rgba(var(--color-secondary));background-color:rgba(var(--color-secondary),.25);transition:all .3s ease-out}#md h2{margin:1.25em 0 .75em;font-family:var(--font-serif);font-weight:700}#md h2{font-size:1.5em}#md p{margin:1em 0}#md h2:first-child,#md p:first-child,#md pre:first-child{margin-top:0}#md h2:last-child,#md p:last-child,#md pre:last-child{margin-bottom:0}#md ol{margin:1em 0;padding-left:1em}#md ol{list-style:decimal}#md li{line-height:150%;margin:.25em 0}#md pre{border-radius:.25rem;padding:1em;max-width:100%;overflow:auto}#md p code{font-size:.95rem}#md code,#md pre{font-family:var(--font-mono);line-height:154%}#md code:not(pre*,a*){background-color:rgba(var(--color-dim),.25);border-radius:.25rem;padding:.125rem .5ch}#md pre{margin:1em 0}#md .katex{font-size:1em}@media (min-width:1024px){#toc{position:absolute;left:100%;padding:0 .5em;width:calc((100vw - 100%)/ 2 - 2em);margin-left:1em;max-height:50vh;overflow-y:auto}}</style><link rel="preload" href="/assets/app.7456a1e8.css" as="style"><link rel="modulepreload" crossorigin="" href="/assets/pl_ts-tagged-union-dispatch.38a492ab.js"><link rel="modulepreload" crossorigin="" href="/assets/TheArticle.e9a8f45a.js"><link rel="preload" href="/assets/TheArticle.080d4a8a.css" as="style"><title>Tymnastics (1): 标签联合动态派发 | Pak</title><meta name="description" content="在 TypeScript 的标签联合（Tagged Union）上类型安全地动态派发。"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous"><meta name="head:count" content="2"></head><body><div id="app" data-server-rendered="true"><!--[--><header class="flex justify-between items-center my-4 gap-2" data-v-6ed7d32f=""><nav class="inline-block px-2 py-1 rounded transition-lively" text="bgd" bg="acc hover:sec" font="mono bold" data-v-6ed7d32f=""><a href="/" class="" data-v-6ed7d32f="">pαk</a></nav><nav class="flex justify-between items-center gap-3" data-v-6ed7d32f=""><button title="Archive" transition-lively="" class="hover:text-sec" data-v-6ed7d32f=""><a href="/archive" class="" title="Archive" data-v-6ed7d32f=""><div i-mdi-text-box="" data-v-6ed7d32f=""></div></a></button><button title="Posts" transition-lively="" class="hover:text-sec" data-v-6ed7d32f=""><a href="/posts" class="" title="Posts" data-v-6ed7d32f=""><div i-mdi-file="" data-v-6ed7d32f=""></div></a></button><button title="Sheets" transition-lively="" class="hover:text-sec" data-v-6ed7d32f=""><a href="/sheets" class="" title="Sheets" data-v-6ed7d32f=""><div i-mdi-table-large="" data-v-6ed7d32f=""></div></a></button><button title="Notes" transition-lively="" class="hover:text-sec" data-v-6ed7d32f=""><a href="/notes" class="" title="Notes" data-v-6ed7d32f=""><div i-mdi-folder="" data-v-6ed7d32f=""></div></a></button></nav></header><main class="text-left"><main class="mb-8"><article class="text-left relative"><header class="flex flex-col justify-start items-start gap-2 mt-4 mb-8"><h1>Tymnastics (1): 标签联合动态派发</h1><div class="flex flex-wrap gap-x-1 gap-y-0.5 justify-start items-center"><span class="flex justify-center"><div btn-icon=""><a href="/posts" class="" title="All posts"><div class="i-mdi-file"></div></a></div></span><span class="flex gap-0.5 justify-center items-center"><span class="inline-block text-xs rounded p-1 font-mono font-bold transition-lively"><!--[--><time>2022/12/22</time><!--]--></span></span><!--[--><span class="flex gap-0.5 justify-center items-center"><span class="inline-block text-xs rounded p-1 font-mono font-bold transition-lively text-acc hover:bg-acc hover:text-bgd"><!--[--><a href="/categories/comp" class="">comp</a><!--]--></span></span><span class="flex gap-0.5 justify-center items-center"><!--[--><span class="inline-block text-xs rounded p-1 font-mono font-bold transition-lively text-sec hover:bg-sec hover:text-bgd"><!--[--><a href="/tags?tag=pl" class=""> @pl</a><!--]--></span><span class="inline-block text-xs rounded p-1 font-mono font-bold transition-lively text-sec hover:bg-sec hover:text-bgd"><!--[--><a href="/tags?tag=typescript" class=""> @typescript</a><!--]--></span><!--]--></span><!----><span class="flex gap-0.5 justify-center items-center"><!--[--><span class="inline-block text-xs rounded p-1 font-mono font-bold transition-lively text-dim"><!--[--><span> #type</span><!--]--></span><!--]--></span><!--]--></div></header><div class="lg:sticky lg:top-4"><nav id="toc"><ul class="flex flex-col gap-1"><!--[--><!--]--></ul></nav></div><div m="b-8"></div><article id="md" lang="zh-Hans"><div><p>在 TypeScript 的标签联合（Tagged Union）上类型安全地动态派发。</p><!-- more --><h2 id="什么是-tymnastics" tabindex="-1">什么是 Tymnastics</h2><p>Tymnastics 即为 <strong>Ty</strong>peScript <strong>M</strong>agics &amp; <strong>Nast</strong>y Tac<strong>tics</strong>😏.</p><h2 id="tldr" tabindex="-1">TL;DR</h2><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#7f848e;font-style:italic">/* 标签联合类型 */</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf"> | </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">interface</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"A"</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">valueA</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">string</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">interface</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"B"</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">valueB</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">number</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* 实现的声明 */</span></span>
<span class="line"><span style="color:#c678dd">interface</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt; {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">: (</span><span style="color:#e06c75;font-style:italic">variant</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">string</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* 分量标签 */</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Discriminant</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">[</span><span style="color:#98c379">"kind"</span><span style="color:#abb2bf">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* 派发 */</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Dispatch</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> (</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> (</span><span style="color:#e06c75;font-style:italic">_</span><span style="color:#abb2bf">: { [</span><span style="color:#e5c07b">_</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">in</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Discriminant</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt;]: </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt; }) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span></span>
<span class="line"><span style="color:#abb2bf">) </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> (</span><span style="color:#e06c75;font-style:italic">_</span><span style="color:#abb2bf">: infer </span><span style="color:#e5c07b">R</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">R</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* 实现 + 派发 */</span></span>
<span class="line"><span style="color:#c678dd">const</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">implA</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">: (</span><span style="color:#e06c75;font-style:italic">variant</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">variant</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">valueA</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">};</span></span>
<span class="line"><span style="color:#c678dd">const</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">dispatch</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">Dispatch</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">A</span><span style="color:#abb2bf">: </span><span style="color:#e06c75">implA</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">B</span><span style="color:#abb2bf">: {</span></span>
<span class="line"><span style="color:#abb2bf">    </span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">: (</span><span style="color:#e06c75;font-style:italic">variant</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#98c379">`</span><span style="color:#c678dd">${</span><span style="color:#e5c07b">variant</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">valueB</span><span style="color:#c678dd">}</span><span style="color:#98c379">`</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  },</span></span>
<span class="line"><span style="color:#abb2bf">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* 动态派发 */</span></span>
<span class="line"><span style="color:#c678dd">function</span><span style="color:#abb2bf"> </span><span style="color:#61afef">dynamic_dispatch</span><span style="color:#abb2bf">(</span><span style="color:#e06c75;font-style:italic">union</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">) {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#c678dd">return</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">dispatch</span><span style="color:#abb2bf">[</span><span style="color:#e5c07b">union</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">] </span><span style="color:#c678dd">as</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt;;</span></span>
<span class="line"><span style="color:#abb2bf">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">/* DEMO */</span></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">a</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"A"</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">valueA</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"42"</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">b</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"B"</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">valueB</span><span style="color:#abb2bf">: </span><span style="color:#d19a66">42</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">strings</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> [</span><span style="color:#e06c75">a</span><span style="color:#abb2bf">, </span><span style="color:#e06c75">b</span><span style="color:#abb2bf">].</span><span style="color:#61afef">map</span><span style="color:#abb2bf">((</span><span style="color:#e06c75;font-style:italic">union</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#61afef">dynamic_dispatch</span><span style="color:#abb2bf">(</span><span style="color:#e06c75">union</span><span style="color:#abb2bf">).</span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">(</span><span style="color:#e06c75">union</span><span style="color:#abb2bf">));</span></span>
<span class="line"></span></code></pre><h2 id="标签联合和动态派发" tabindex="-1">标签联合和动态派发</h2><p>在 Rust 中，有一个 <a href="https://docs.rs/enum_dispatch/latest/enum_dispatch/" target="_blank" rel="noopener"><code>enum_dispatch</code></a> crate，在参与派发的类型可枚举的情况下，可以通过过程宏为枚举（<code>enum</code>）自动实现要派发的特征（<code>trait</code>)，而不需要用到虚表 <code>dyn</code>，可以加速动态派发并减少 boilerplate 工作，同时还保证类型安全（当然，这是静态强类型语言）。</p><p>TypeScript 提供了类似 Rust 枚举的标签联合类型（tagged union）。通常的实践是，每一个分量（variant）用一个常量标签（tag, discriminant）标注。</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Union</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf"> | </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">; </span><span style="color:#7f848e;font-style:italic">// &lt;- 标签联合</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">interface</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">: </span><span style="color:#98c379">"A"</span><span style="color:#abb2bf">; </span><span style="color:#7f848e;font-style:italic">// &lt;- 标签</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">valueA</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">string</span><span style="color:#abb2bf">; </span><span style="color:#7f848e;font-style:italic">// &lt;- 其他数据</span></span>
<span class="line"><span style="color:#abb2bf">} </span><span style="color:#7f848e;font-style:italic">// &lt;- 分量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">// ...</span></span>
<span class="line"></span></code></pre><p>TypeScript 的联合，底层仍是 <code>Object</code> 类型，分量的类型在编译期被擦除，所以在运行期的动态派发时，需要利用分量的标签。因此，需要一个从分量标签到该分量对应的实现的映射。</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">const</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">dispatch</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">A</span><span style="color:#abb2bf">: {</span></span>
<span class="line"><span style="color:#abb2bf">    </span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">: (</span><span style="color:#e06c75;font-style:italic">variant</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">variant</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">valueA</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  },</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#e06c75">B</span><span style="color:#abb2bf">: {</span></span>
<span class="line"><span style="color:#abb2bf">    </span><span style="color:#61afef">getValue</span><span style="color:#abb2bf">: (</span><span style="color:#e06c75;font-style:italic">variant</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">=&gt;</span><span style="color:#abb2bf"> </span><span style="color:#98c379">`</span><span style="color:#c678dd">${</span><span style="color:#e5c07b">variant</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">valueB</span><span style="color:#c678dd">}</span><span style="color:#98c379">`</span><span style="color:#abb2bf">,</span></span>
<span class="line"><span style="color:#abb2bf">  },</span></span>
<span class="line"><span style="color:#abb2bf">};</span></span>
<span class="line"></span></code></pre><p>但是，如何确保这个映射是类型安全的呢？有两个问题需要关注：</p><ol><li>确保分量的标签和分量的实现是类型匹配的。也就是确保在 <code>VariantA</code> 上调用时会被派发到 <code>Impl&lt;VariantA&gt;</code> 的实现。</li><li>所有分量是否都有完整且正确的实现？</li></ol><h2 id="标签映射到实现" tabindex="-1">标签映射到实现</h2><p>标签 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.02778em">D</span></span></span></span> 和实现 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.07847em">I</span></span></span></span> 存在于值空间，而分量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span></span></span></span> 只存在于类型空间，前两者都由分量类型确定。因此，为保证映射的正确性，需要遍历联合类型，这在 TypeScript 中应当使用条件类型（conditional type）。联合类型在条件类型中会被展开并逐一计算类型，在计算结果上重新求联合。</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">UnboxUnion</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Something</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt; </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#abb2bf">                   </span><span style="color:#7f848e;font-style:italic">// ^^^^^^^^^^^^^</span></span>
<span class="line"><span style="color:#abb2bf">                   </span><span style="color:#7f848e;font-style:italic">//                 ^^^^^^^^^^^^</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">BoxUnion</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Something</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">// UnboxUnion&lt;A | B&gt; == Something&lt;A&gt; | Something&lt;B&gt;</span></span>
<span class="line"><span style="color:#7f848e;font-style:italic">// BoxUnion&lt;A | B&gt; == Something&lt;A|B&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">DispatchUnion</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">T</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> { [</span><span style="color:#e5c07b">_</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">in</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Discriminant</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt;]: </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">T</span><span style="color:#abb2bf">&gt; } </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">; </span></span>
<span class="line"></span></code></pre><p>其中索引处的 <code>[_ in Discriminant&lt;T&gt;]</code> 用于字面量类型转换为值。当联合类型作为 <code>DispatchUnion</code> 的类型参数时，每一种类型会分别参与运算（展开？），因为这里泛型 <code>T</code> 并没有被包装在其他类型内。</p><p>因此确保 <code>Discriminant&lt;T&gt;</code> 和 <code>Impl&lt;T&gt;</code> 的类型参数始终一致。但得到的结果仍然是 <code>|</code> 连接的多个联合类型：</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">_</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">DispatchUnion</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt;; </span><span style="color:#7f848e;font-style:italic">// 等于...</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">_</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> { </span><span style="color:#e06c75">A</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf">&gt; } | { </span><span style="color:#e06c75">B</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">&gt; }</span></span>
<span class="line"><span style="color:#abb2bf">                            </span><span style="color:#7f848e;font-style:italic">// ^ 错误的</span></span>
<span class="line"></span></code></pre><p>而我们想要的是这些类型的交集类型（intersection）——确保所有分量的实现都是完整且正确的。</p><h2 id="逆变" tabindex="-1">逆变</h2><p>如何从联合类型变为交集类型？这里就需要用到逆变（contravariant）。</p><p>函数的参数位置就是发生逆变的一个例子。设 <code>F&lt;T&gt;</code> 表示 <code>(_: T): any</code>，则有如下 Venn 图。</p><p><svg version="1.1" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><text x="187.10776" y="129.28905" fill="currentColor" font-family="sans-serif" font-size="40px" style="line-height:1.25" xml:space="preserve"><tspan x="187.10776" y="129.28905"></tspan></text><g transform="translate(.90005 -.60281)"></g><g transform="translate(-.60867 -13.546)"><circle cx="100.76" cy="132.93" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><circle cx="178.41" cy="132.93" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><path d="m140.03 81.595a64.485 64.485 0 0 0-25.787 51.377 64.485 64.485 0 0 0 25.662 51.283 64.485 64.485 0 0 0 25.662-51.283 64.485 64.485 0 0 0-25.537-51.377z" fill="currentColor" fill-opacity=".25"></path><text x="69.916725" y="141.68504" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="69.916725" y="141.68504" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T</tspan></text><text x="213.31772" y="141.56505" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="213.31772" y="141.56505" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">U</tspan></text><text x="140.00302" y="238.37758" fill="currentColor" font-family="sans-serif" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="140.00302" y="238.37758" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T&amp;U</tspan></text></g><g transform="translate(-.60867 -13.029)"><circle cx="334.81" cy="131.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><circle cx="412.46" cy="131.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><path d="m334.27 66.723a64.485 64.485 0 0 0-64.484 64.484 64.485 64.485 0 0 0 64.484 64.486 64.485 64.485 0 0 0 38.824-13.201 64.485 64.485 0 0 0 38.824 13.201 64.485 64.485 0 0 0 64.484-64.486 64.485 64.485 0 0 0-64.484-64.484 64.485 64.485 0 0 0-38.699 13.107 64.485 64.485 0 0 0-38.949-13.107z" fill="currentColor" fill-opacity=".25"></path><text x="303.96799" y="139.968" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="303.96799" y="139.968" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T</tspan></text><text x="447.36899" y="139.84801" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="447.36899" y="139.84801" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">U</tspan></text><text x="374.05429" y="236.66054" fill="currentColor" font-family="sans-serif" font-size="24px" text-align="center" text-anchor="middle" style="line-height:1.25" xml:space="preserve"><tspan x="374.05429" y="236.66054" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">T|U</tspan></text></g><circle cx="102.61" cy="352.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><circle cx="180.26" cy="352.21" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><path d="m141.88 300.88a64.485 64.485 0 0 0-25.787 51.377 64.485 64.485 0 0 0 25.662 51.283 64.485 64.485 0 0 0 25.662-51.283 64.485 64.485 0 0 0-25.537-51.377z" fill="currentColor" fill-opacity=".25"></path><g fill="currentColor" font-size="24px"><text x="75.765312" y="360.97333" font-family="var(--font-mono)" style="line-height:1.25" xml:space="preserve"><tspan x="75.765312" y="360.97333" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&gt;</tspan></text><text x="207.16631" y="360.97333" font-family="var(--font-mono)" style="line-height:1.25" xml:space="preserve"><tspan x="207.16631" y="360.97333" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;U&gt;</tspan></text><text x="141.3116" y="457.66583" font-family="sans-serif" style="line-height:1.25" xml:space="preserve"><tspan x="141.3116" y="457.66583" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T|U&gt;</tspan></text></g><g transform="translate(.90005 -11.226)"><circle cx="330.84" cy="364.64" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><circle cx="408.49" cy="364.64" r="64.485" fill="none" stroke="currentColor" stroke-width="4"></circle><path d="m330.3 300.15a64.485 64.485 0 0 0-64.484 64.484 64.485 64.485 0 0 0 64.484 64.486 64.485 64.485 0 0 0 38.824-13.201 64.485 64.485 0 0 0 38.824 13.201 64.485 64.485 0 0 0 64.484-64.486 64.485 64.485 0 0 0-64.484-64.484 64.485 64.485 0 0 0-38.699 13.107 64.485 64.485 0 0 0-38.949-13.107z" fill="currentColor" fill-opacity=".25"></path><text x="304.00198" y="373.3992" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="304.00198" y="373.3992" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&gt;</tspan></text><text x="437.40298" y="373.27921" fill="currentColor" font-family="var(--font-mono)" font-size="24px" style="line-height:1.25" xml:space="preserve"><tspan x="437.40298" y="373.27921" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;U&gt;</tspan></text><text x="369.54831" y="470.09174" fill="currentColor" font-family="sans-serif" font-size="24px" text-align="center" text-anchor="middle" style="line-height:1.25" xml:space="preserve"><tspan x="369.54831" y="470.09174" font-family="var(--font-mono)" font-size="24px" text-align="center" text-anchor="middle">F&lt;T&amp;U&gt;</tspan></text></g></svg></p><p>能看出来“逆”，但理解不能？用集合来表示：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>×</mo><mi mathvariant="normal">Ω</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">(</mo><mi>U</mi><mo>×</mo><mi mathvariant="normal">Ω</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo>∪</mo><mi>U</mi><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">Ω</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>×</mo><mi mathvariant="normal">Ω</mi><mo stretchy="false">)</mo><mo>∩</mo><mo stretchy="false">(</mo><mi>U</mi><mo>×</mo><mi mathvariant="normal">Ω</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>T</mi><mo>∩</mo><mi>U</mi><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">Ω</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} (T \times \Omega) \cup (U \times \Omega) &amp;= (T \cup U) \times \Omega \\ (T \times \Omega) \cap (U \times \Omega) &amp;= (T \cap U) \times \Omega \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span><span class="mclose">)</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord">Ω</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>而</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo>∈</mo><mi>T</mi><mo>∪</mo><mi>U</mi><mo>⇒</mo><mi>x</mi><mo>∈</mo><mi>T</mi><mo>∨</mo><mi>x</mi><mo>∈</mo><mi>U</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>x</mi><mo>∈</mo><mi>T</mi><mo>∩</mo><mi>U</mi><mo>⇒</mo><mi>x</mi><mo>∈</mo><mi>T</mi><mo>∧</mo><mi>x</mi><mo>∈</mo><mi>U</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} x \in T \cup U \Rightarrow x \in T \lor x \in U \\ x \in T \cap U \Rightarrow x \in T \land x \in U \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000000000000004em;vertical-align:-1.2500000000000002em"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7500000000000002em"><span style="top:-3.91em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∨</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∧</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2500000000000002em"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>所以，在我们的类型标注中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>∪</mo><mi>U</mi><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">(T \cup U) \times \Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord">Ω</span></span></span></span> 被记作 <code>F&lt;T|U&gt;</code>，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>T</mi><mo>∩</mo><mi>U</mi><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">(T \cap U) \times \Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.10903em">U</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord">Ω</span></span></span></span> 被记作 <code>F&lt;T&amp;U&gt;</code>。所以 <code>F&lt;T&gt;</code> 和 <code>F&lt;U&gt;</code> 的交集是 <code>F&lt;T|U&gt;</code>，而并集是 <code>F&lt;T&amp;U&gt;</code>。</p><p>所以，要想从 <code>T|U</code> 获得 <code>T&amp;U</code>，你需要：</p><ol><li>从 <code>T|U</code> 获得 <code>F&lt;T&gt;|F&lt;U&gt;</code></li><li>令 <code>F&lt;T&gt;</code> 并 <code>F&lt;U&gt;</code> 的计算结果为 <code>F&lt;R&gt;</code>，推导 <code>R</code> 的类型，<code>R</code> 是 <code>T&amp;U</code></li></ol><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">StepOne</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">Union</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Union</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">F</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">Union</span><span style="color:#abb2bf">&gt; </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#c678dd">type</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">StepTwo</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">FuncUnion</span><span style="color:#abb2bf">&gt; </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> (</span><span style="color:#e5c07b">FuncUnion</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">any</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">FuncUnion</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">) </span><span style="color:#c678dd">extends</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">F</span><span style="color:#abb2bf">&lt;infer </span><span style="color:#e5c07b">R</span><span style="color:#abb2bf">&gt; </span><span style="color:#c678dd">?</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">R</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">:</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">never</span><span style="color:#abb2bf">;</span></span>
<span class="line"></span></code></pre><p>注意第二步仍然需要上文的展开技巧，因为需要根据 <code>F&lt;T&gt;</code> 和 <code>F&lt;U&gt;</code> 的并运算的结果做推断，而不是在 <code>F&lt;T&gt;|F&lt;U&gt;</code> 类型上做推断。<strong>如果不展开，TypeScript 会把联合类型视作一个整体</strong>。</p><h2 id="泛型擦除" tabindex="-1">泛型擦除</h2><p>得到的交集类型，就是我们要的从分量标签到该分量对应的实现的映射的类型。但还有一个小问题：变成了彻底的静态派发。而我们最终想要的是动态派发，即运行时传入一个动态的标签联合类型，派发到正确的实现，而不是传入一个具体的分量，在编译期确定正确的实现。</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">declare</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">a</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">VariantA</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#c678dd">declare</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">b</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">VariantB</span><span style="color:#abb2bf">;</span></span>
<span class="line"><span style="color:#c678dd">declare</span><span style="color:#abb2bf"> </span><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">u</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">implA</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">dispatch</span><span style="color:#abb2bf">[</span><span style="color:#e5c07b">a</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">]; </span><span style="color:#7f848e;font-style:italic">// Impl&lt;A&gt;</span></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">implB</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">dispatch</span><span style="color:#abb2bf">[</span><span style="color:#e5c07b">b</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">]; </span><span style="color:#7f848e;font-style:italic">// Impl&lt;B&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c678dd">let</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">implU</span><span style="color:#abb2bf"> </span><span style="color:#56b6c2">=</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">dispatch</span><span style="color:#abb2bf">[</span><span style="color:#e5c07b">u</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">]; </span><span style="color:#7f848e;font-style:italic">// Impl&lt;A&gt; | Impl&lt;B&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7f848e;font-style:italic">// implU.getValue(?) &lt;- 这里的 ? 应该是什么类型？编译期无法确定！</span></span>
<span class="line"></span></code></pre><p>所以，我们需要一个 <code>(_: MyUnion): Impl&lt;MyUnion&gt;</code> 类型的函数来实现动态派发。具体实现非常简单，对于任何一个 <code>MyUnion</code> 类型的值（可能是任何一个分量），取其标签作为下标，我们构造的 <code>Dispatch&lt;MyUnion&gt;</code> 将它映射到的值一定是其分量对应的 <code>Impl</code>。而我们的静态派发是 <code>&lt;T extends MyUnion&gt;(_: T): Impl&lt;T&gt;</code>。所以，我们只需要把所有的泛型 <code>T</code> 全部擦除为动态的 <code>MyUnion</code> 即可。</p><pre class="shiki" style="background-color:#282c34"><code><span class="line"><span style="color:#c678dd">function</span><span style="color:#abb2bf"> </span><span style="color:#61afef">dynamic_dispatch</span><span style="color:#abb2bf">(</span><span style="color:#e06c75;font-style:italic">union</span><span style="color:#abb2bf">: </span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">) {</span></span>
<span class="line"><span style="color:#abb2bf">  </span><span style="color:#c678dd">return</span><span style="color:#abb2bf"> </span><span style="color:#e06c75">dispatch</span><span style="color:#abb2bf">[</span><span style="color:#e5c07b">union</span><span style="color:#abb2bf">.</span><span style="color:#e06c75">kind</span><span style="color:#abb2bf">] </span><span style="color:#c678dd">as</span><span style="color:#abb2bf"> </span><span style="color:#e5c07b">Impl</span><span style="color:#abb2bf">&lt;</span><span style="color:#e5c07b">MyUnion</span><span style="color:#abb2bf">&gt;;</span></span>
<span class="line"><span style="color:#abb2bf">}</span></span>
<span class="line"></span></code></pre><p><s>好麻烦，还不如用 Rust 🤣</s>。以及，由于没有 HKT，这里的 <code>Discriminant</code> 和 <code>Dispatch</code> 两个泛型每次都需要重新实现一份，<s>还不如用 Rust/C++</s>，<s>你的键盘不是有 Ctrl, C, V 三个键吗</s>。</p><h2 id="参考文献" tabindex="-1">参考文献</h2><p><a href="https://fettblog.eu/typescript-union-to-intersection/" target="_blank" rel="noopener">TypeScript: Union to intersection type</a>.</p></div></article></article></main></main><!----><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"store":{"title":"","webfont":{"Noto Sans":false,"Noto Serif":false,"Noto Sans CJK SC":false,"Noto Serif CJK SC":false,"JetBrains Mono":false},"accentColors":{"light-accent":"#2177B8","light-secondary":"#003A70","dark-accent":"#FBB929","dark-secondary":"#FFE900"}}}}'</script><script>!function(){var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("color-scheme")||"auto",t=(document.documentElement.className="dark"===a||t&&"light"!==a?"dark":"",localStorage.getItem("typesetting::accent_color"));if(t){a=JSON.parse(t),t=Object.entries(a).map(e=>`--accent-${e[0]}: ${e[1]};`).join("\n");let e=document.createElement("style");e.type="text/css",e.innerText=`:root{${t}}`,document.head.appendChild(e)}}()</script><link rel="stylesheet" href="/assets/app.7456a1e8.css"><link rel="stylesheet" href="/assets/TheArticle.080d4a8a.css"></body></html>